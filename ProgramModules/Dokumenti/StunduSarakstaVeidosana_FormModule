&НаСервере
Процедура ОбработкаПроверкиЗаполненияНаСервере(Отказ, ПроверяемыеРеквизиты)
	
	Для индекс = 0 По 12 Цикл
		
		ПроверяемыйПредмет = "MacibuPrieksmets" + индекс;	
		ПроверяемыйУчитель = "Skolotajs" + индекс;
		ПроверяемыйКабинет = "KabinetaNumurs" + индекс;
		
		Если Объект[ПроверяемыйПредмет] <> Справочники.MacibuPrieksmeti.ПустаяСсылка() ИЛИ Объект[ПроверяемыйУчитель] <> Справочники.Skolotaji.ПустаяСсылка() ИЛИ Объект[ПроверяемыйКабинет] <> 0 Тогда
			
			Если Объект[ПроверяемыйПредмет] <> Справочники.MacibuPrieksmeti.ПустаяСсылка() И Объект[ПроверяемыйУчитель] <> Справочники.Skolotaji.ПустаяСсылка() И Объект[ПроверяемыйКабинет] <> 0 Тогда
				
				//Правильно	
				
			Иначе
				
				Если Объект[ПроверяемыйПредмет] <> Справочники.MacibuPrieksmeti.ПустаяСсылка() И Объект[ПроверяемыйУчитель] <> Справочники.Skolotaji.ПустаяСсылка() И Объект[ПроверяемыйКабинет] = 0 ИЛИ Объект[ПроверяемыйПредмет] <> Справочники.MacibuPrieksmeti.ПустаяСсылка() И Объект[ПроверяемыйУчитель] = Справочники.Skolotaji.ПустаяСсылка() И Объект[ПроверяемыйКабинет] = 0 ИЛИ Объект[ПроверяемыйПредмет] <> Справочники.MacibuPrieksmeti.ПустаяСсылка() И Объект[ПроверяемыйУчитель] = Справочники.Skolotaji.ПустаяСсылка() И Объект[ПроверяемыйКабинет] <> 0 Тогда
					
					СтандартныйУрок = Справочники.Grupas.НайтиПоНаименованию(Объект.Grupa).MacibuPrieksmeti;
					
					Если СтандартныйУрок.Найти(Объект[ПроверяемыйПредмет],"Nosaukums") <> Неопределено Тогда
						
						Объект[ПроверяемыйУчитель] = СтандартныйУрок.Найти(Объект[ПроверяемыйПредмет],"Nosaukums").Skolotajs;
						Объект[ПроверяемыйКабинет] = СтандартныйУрок.Найти(Объект[ПроверяемыйПредмет],"Nosaukums").KabinetaNumurs;
						
						Если Объект[ПроверяемыйУчитель] = Справочники.Skolotaji.ПустаяСсылка() ИЛИ Объект[ПроверяемыйКабинет] = 0 Тогда
						
							Сообщить("Ievediet visus rekvizītus priekš " + индекс + ".stundai!(Datubaze nav visus standarta rekvezitus!)");
							Отказ = Истина;	
						
						Иначе
						
							Сообщить("" + индекс + ".stunda: Rekvizīti izvēlējās no grupai " + Объект.Grupa + " datubaze!(iegramatot velreiz)");
							Отказ = истина;	
						
						КонецЕсли; 
						
						
					Иначе
						
						Сообщить("Ievediet visus rekvizītus priekš " + индекс + ".stundai!(Standarta stunda nav datubaze!)");
						Отказ = Истина;	
						
					КонецЕсли; 
					
				Иначе 
					
					Сообщить("Ievediet visus rekvizītus priekš " + индекс + ".stundai!");
					Отказ = Истина;
					
				КонецЕсли;
				
			КонецЕсли;  		
			
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура GrupaОбработкаНаСервере(Группа)

	Если Объект.NedēļasDiena <> Перечисления.NedēļasDienas.ПустаяСсылка() Тогда
		
		Для Индекс = 0 По 12 Цикл
		
			УчебПредмет = "MacibuPrieksmets" + Индекс;
			Учитель = "Skolotajs" + Индекс;
			КабНр = "KabinetaNumurs" + Индекс;
			
			Объект[УчебПредмет] = Справочники.MacibuPrieksmeti.ПустаяСсылка();
			Объект[Учитель] = Справочники.Skolotaji.ПустаяСсылка();
			Объект[КабНр] = 0;
		
		КонецЦикла;
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	StunduSaraksts.MacibuPrieksmets КАК MacibuPrieksmets,
		|	StunduSaraksts.Skolotajs КАК Skolotajs,
		|	StunduSaraksts.KabinetaNumurs КАК KabinetaNumurs,
		|	StunduSaraksts.StundasNumurs КАК StundasNumurs
		|ИЗ
		|	РегистрСведений.StunduSaraksts КАК StunduSaraksts
		|ГДЕ
		|	StunduSaraksts.NedēļasDiena = &NedēļasDiena
		|	И StunduSaraksts.Grupa = &Grupa
		|
		|УПОРЯДОЧИТЬ ПО
		|	StundasNumurs";
		
		Запрос.УстановитьПараметр("Grupa", Группа);
		Запрос.УстановитьПараметр("NedēļasDiena", Объект.NedēļasDiena);
		
		РезультатЗапроса = Запрос.Выполнить();
		
		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
		
		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
			
			УчебПредмет = "MacibuPrieksmets" + ВыборкаДетальныеЗаписи.StundasNumurs;
			Учитель = "Skolotajs" + ВыборкаДетальныеЗаписи.StundasNumurs;
			КабНр = "KabinetaNumurs" + ВыборкаДетальныеЗаписи.StundasNumurs;	
			
			Объект[УчебПредмет] = ВыборкаДетальныеЗаписи.MacibuPrieksmets;
			Объект[Учитель] = ВыборкаДетальныеЗаписи.Skolotajs;
			Объект[КабНр] = ВыборкаДетальныеЗаписи.KabinetaNumurs;
			
		КонецЦикла;
		
		
	КонецЕсли; 	

КонецПроцедуры // GrupaОбработкаНаСервере()

&НаКлиенте
Процедура GrupaОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	GrupaОбработкаНаСервере(ВыбранноеЗначение);
КонецПроцедуры

&НаСервере
Процедура NedēļasDienaОбработкаВыбораНаСервере(ДеньНедели)
	
	Если Объект.Grupa <> Справочники.Grupas.ПустаяСсылка() Тогда
		
		Для Индекс = 0 По 12 Цикл
		
			УчебПредмет = "MacibuPrieksmets" + Индекс;
			Учитель = "Skolotajs" + Индекс;
			КабНр = "KabinetaNumurs" + Индекс;
			
			Объект[УчебПредмет] = Справочники.MacibuPrieksmeti.ПустаяСсылка();
			Объект[Учитель] = Справочники.Skolotaji.ПустаяСсылка();
			Объект[КабНр] = 0;
		
		КонецЦикла;
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	StunduSaraksts.MacibuPrieksmets КАК MacibuPrieksmets,
		|	StunduSaraksts.Skolotajs КАК Skolotajs,
		|	StunduSaraksts.KabinetaNumurs КАК KabinetaNumurs,
		|	StunduSaraksts.StundasNumurs КАК StundasNumurs
		|ИЗ
		|	РегистрСведений.StunduSaraksts КАК StunduSaraksts
		|ГДЕ
		|	StunduSaraksts.NedēļasDiena = &NedēļasDiena
		|	И StunduSaraksts.Grupa = &Grupa
		|
		|УПОРЯДОЧИТЬ ПО
		|	StundasNumurs";
		
		Запрос.УстановитьПараметр("Grupa", Объект.Grupa);
		Запрос.УстановитьПараметр("NedēļasDiena", ДеньНедели);
		
		РезультатЗапроса = Запрос.Выполнить();
		
		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
		
		Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
			
			УчебПредмет = "MacibuPrieksmets" + ВыборкаДетальныеЗаписи.StundasNumurs;
			Учитель = "Skolotajs" + ВыборкаДетальныеЗаписи.StundasNumurs;
			КабНр = "KabinetaNumurs" + ВыборкаДетальныеЗаписи.StundasNumurs;	
			
			Объект[УчебПредмет] = ВыборкаДетальныеЗаписи.MacibuPrieksmets;
			Объект[Учитель] = ВыборкаДетальныеЗаписи.Skolotajs;
			Объект[КабНр] = ВыборкаДетальныеЗаписи.KabinetaNumurs;
			
		КонецЦикла;
		
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура NedēļasDienaОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	NedēļasDienaОбработкаВыбораНаСервере(ВыбранноеЗначение);
КонецПроцедуры

&НаСервере
Функция ParādītGrafikuНаСервере()
	
		
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	StunduSaraksts.MacibuPrieksmets КАК MacibuPrieksmets,
		|	StunduSaraksts.Skolotajs КАК Skolotajs,
		|	StunduSaraksts.KabinetaNumurs КАК KabinetaNumurs,
		|	StunduSaraksts.StundasNumurs КАК StundasNumurs,
		|	StunduSaraksts.NedēļasDiena КАК NedēļasDiena
		|ИЗ
		|	РегистрСведений.StunduSaraksts КАК StunduSaraksts
		|ГДЕ
		|	StunduSaraksts.Grupa = &Grupa
		|
		|УПОРЯДОЧИТЬ ПО
		|	StundasNumurs,
		|	NedēļasDiena";
	
	Запрос.УстановитьПараметр("Grupa", Объект.Grupa);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Таб = Новый ТабличныйДокумент;
	Таб.ПолеСверху = 3;
	Таб.ИмяПараметровПечати = "DRUKAS_PARAMETRI_stundu_grafiks_drukasana";
	Таб.АвтоМасштаб = Истина;
	Макет = ПолучитьОбщийМакет("StunduGrafiks");
	ОбластьШапка = Макет.ПолучитьОбласть("Шапка");
	ОбластьУрок = Макет.ПолучитьОбласть("Stunda");
	
	ОбластьШапка.Параметры.subjekts = Объект.Grupa;
	Таб.Вывести(ОбластьШапка);
		
	ОбластьУрок.Параметры.StNr = 0;
	ОбластьУрок.Параметры.time = "7:45 - 8:25";
	ТекущийУрок = 0;
	
	Очистка = Новый Структура;
	Очистка.Вставить("Prieksmets1");
	Очистка.Вставить("Prieksmets2");
	Очистка.Вставить("Prieksmets3");
	Очистка.Вставить("Prieksmets4");
	Очистка.Вставить("Prieksmets5");
	
	Очистка.Вставить("Skolotajs1");
	Очистка.Вставить("Skolotajs2");
	Очистка.Вставить("Skolotajs3");
	Очистка.Вставить("Skolotajs4");
	Очистка.Вставить("Skolotajs5");
	
	Очистка.Вставить("KabNr1");
	Очистка.Вставить("KabNr2");
	Очистка.Вставить("KabNr3");
	Очистка.Вставить("KabNr4");
	Очистка.Вставить("KabNr5");
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		
		Пока ТекущийУрок < ВыборкаДетальныеЗаписи.StundasNumurs Цикл
			
			ТекущийУрок = ТекущийУрок + 1;
			Таб.Вывести(ОбластьУрок);
			ОбластьУрок.Параметры.Заполнить(Очистка);
			ОбластьУрок.Параметры.StNr = ТекущийУрок;
			
			Если ТекущийУрок = 1 Тогда
				
				ОбластьУрок.Параметры.time = "8:30 - 9:10";		
				
			ИначеЕсли ТекущийУрок = 2 Тогда 
				
				ОбластьУрок.Параметры.time = "9:15 - 9:55";
				
			ИначеЕсли ТекущийУрок = 3 Тогда 
				
				ОбластьУрок.Параметры.time = "10:10 - 10:50";
				
			ИначеЕсли ТекущийУрок = 4 Тогда 
				
				ОбластьУрок.Параметры.time = "10:55 - 11:35";
				
			ИначеЕсли ТекущийУрок = 5 Тогда 
				
				ОбластьУрок.Параметры.time = "11:45 - 12:25";
				
			ИначеЕсли ТекущийУрок = 6 Тогда 
				
				ОбластьУрок.Параметры.time = "12:30 - 13:10";
				
			ИначеЕсли ТекущийУрок = 7 Тогда 
				
				ОбластьУрок.Параметры.time = "13:20 - 14:00";
				
			ИначеЕсли ТекущийУрок = 8 Тогда 
				
				ОбластьУрок.Параметры.time = "14:05 - 14:45";
				
			ИначеЕсли ТекущийУрок = 9 Тогда 
				
				ОбластьУрок.Параметры.time = "14:50 - 15:30";
				
			ИначеЕсли ТекущийУрок = 10 Тогда 
				
				ОбластьУрок.Параметры.time = "15:35 - 16:15";
				
			ИначеЕсли ТекущийУрок = 11 Тогда 
				
				ОбластьУрок.Параметры.time = "16:20 - 17:00";
				
			ИначеЕсли ТекущийУрок = 12 Тогда 
				
				ОбластьУрок.Параметры.time = "17:05 - 17:45";
				
			КонецЕсли;	
			
		КонецЦикла;  
		
		
		Если ВыборкаДетальныеЗаписи.NedēļasDiena = Перечисления.NedēļasDienas.Pirmdiena Тогда
			
			ОбластьУрок.Параметры.Prieksmets1 = ВыборкаДетальныеЗаписи.MacibuPrieksmets;	
			ОбластьУрок.Параметры.Skolotajs1 = ВыборкаДетальныеЗаписи.Skolotajs;
			ОбластьУрок.Параметры.KabNr1 = "" + ВыборкаДетальныеЗаписи.KabinetaNumurs + ". kab.";
			
		ИначеЕсли ВыборкаДетальныеЗаписи.NedēļasDiena = Перечисления.NedēļasDienas.Otrdiena Тогда
		
			ОбластьУрок.Параметры.Prieksmets2 = ВыборкаДетальныеЗаписи.MacibuPrieksmets;	
			ОбластьУрок.Параметры.Skolotajs2 = ВыборкаДетальныеЗаписи.Skolotajs;
			ОбластьУрок.Параметры.KabNr2 = "" + ВыборкаДетальныеЗаписи.KabinetaNumurs + ". kab.";
			
		ИначеЕсли ВыборкаДетальныеЗаписи.NedēļasDiena = Перечисления.NedēļasDienas.Tresdiena Тогда
		
			ОбластьУрок.Параметры.Prieksmets3 = ВыборкаДетальныеЗаписи.MacibuPrieksmets;	
			ОбластьУрок.Параметры.Skolotajs3 = ВыборкаДетальныеЗаписи.Skolotajs;
			ОбластьУрок.Параметры.KabNr3 = "" + ВыборкаДетальныеЗаписи.KabinetaNumurs + ". kab.";
			
		ИначеЕсли ВыборкаДетальныеЗаписи.NedēļasDiena = Перечисления.NedēļasDienas.Ceturdiena Тогда
		
			ОбластьУрок.Параметры.Prieksmets4 = ВыборкаДетальныеЗаписи.MacibuPrieksmets;	
			ОбластьУрок.Параметры.Skolotajs4 = ВыборкаДетальныеЗаписи.Skolotajs;
			ОбластьУрок.Параметры.KabNr4 = "" + ВыборкаДетальныеЗаписи.KabinetaNumurs + ". kab.";
			
		ИначеЕсли ВыборкаДетальныеЗаписи.NedēļasDiena = Перечисления.NedēļasDienas.Piektdiena Тогда
		
			ОбластьУрок.Параметры.Prieksmets5 = ВыборкаДетальныеЗаписи.MacibuPrieksmets;	
			ОбластьУрок.Параметры.Skolotajs5 = ВыборкаДетальныеЗаписи.Skolotajs;
			ОбластьУрок.Параметры.KabNr5 = "" + ВыборкаДетальныеЗаписи.KabinetaNumurs + ". kab.";		
		
		КонецЕсли; 
		
	КонецЦикла;
	
	Таб.Вывести(ОбластьУрок);
	
	Возврат Таб;
	
КонецФункции

&НаКлиенте
Процедура ParādītGrafiku(Команда)
	ParādītGrafikuНаСервере().Показать("Grupas grafiks");
	
КонецПроцедуры

&НаКлиенте
Процедура IedrukatGrafiku(Команда)
	ParādītGrafikuНаСервере().Напечатать();	
КонецПроцедуры

&НаСервере
Процедура ПриЗакрытииНаСервере()
	
	НашДокумент = Документы.StunduSarakstaVeidosana.НайтиПоНомеру(Объект.Номер); 
	
	Если НашДокумент <> Документы.StunduSarakstaVeidosana.ПустаяСсылка() Тогда
	
		НашДокумент.ПолучитьОбъект().Удалить();	
	
	КонецЕсли; 
	
КонецПроцедуры

&НаКлиенте
Процедура ПриЗакрытии(ЗавершениеРаботы)
	ПриЗакрытииНаСервере();
КонецПроцедуры
